<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>건물 높이 측정기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 다이어그램 하이라이트 효과를 위한 CSS */
        .diagram-part {
            transition: all 0.3s ease-in-out;
        }
        .highlight-blue {
            stroke: #3b82f6;
            fill: #3b82f6;
            stroke-width: 2.5;
            font-weight: bold;
        }
        .highlight-red {
            stroke: #ef4444;
            fill: #ef4444;
            stroke-width: 2.5;
            font-weight: bold;
        }
        .default-stroke {
            stroke: black;
        }
        .default-fill {
            fill: #334155;
        }
        .default-angle-stroke {
             stroke: #ef4444;
        }

        /* 계산 과정 애니메이션 */
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.6s ease-out forwards;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen font-sans flex flex-col items-center justify-center p-4">

    <main class="w-full max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-slate-800 mb-2">건물 높이 측정기</h1>
            <p class="text-lg text-slate-600">클리노미터를 이용해 학교 건물의 높이를 측정해 봅시다!</p>
        </header>

        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Input Card 1 -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-5 flex flex-col items-center text-center transition-shadow hover:shadow-md">
                    <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m-1 4h1m5-8h1m-1 4h1m-1 4h1M5 21V5a2 2 0 012-2h10a2 2 0 012 2v16" />
                        </svg>
                    </div>
                    <label for="distance" class="text-slate-700 font-semibold mb-3 text-md">1. 건물과 나의 거리 (m)</label>
                    <input type="number" id="distance" placeholder="예: 15.0" class="w-full text-center p-2 border-2 border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" />
                </div>
                <!-- Input Card 2 -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-5 flex flex-col items-center text-center transition-shadow hover:shadow-md">
                    <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                    </div>
                    <label for="eyeHeight" class="text-slate-700 font-semibold mb-3 text-md">2. 나의 눈높이 (m)</label>
                    <input type="number" id="eyeHeight" placeholder="예: 1.6" class="w-full text-center p-2 border-2 border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" />
                </div>
                <!-- Input Card 3 -->
                <div class="bg-slate-50 border border-slate-200 rounded-lg p-5 flex flex-col items-center text-center transition-shadow hover:shadow-md">
                    <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2">
                            <path strokeLinecap="round" strokeLinejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <label for="protractorAngle" class="text-slate-700 font-semibold mb-3 text-md">3. 각도기로 잰 각도 (°)</label>
                    <input type="number" id="protractorAngle" placeholder="예: 52" class="w-full text-center p-2 border-2 border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" />
                    <p class="text-xs text-slate-500 mt-2">실제 계산 각도 = 90° - 입력 각도</p>
                </div>
            </div>

            <div class="my-8 px-4 flex justify-center" aria-hidden="true">
                <svg viewBox="0 0 400 280" class="w-full max-w-lg" aria-labelledby="diagram-title" role="img">
                    <title id="diagram-title">측정 원리 다이어그램: 건물, 사람, 거리(d), 눈높이(h1), 건물 높이(H), 그리고 각도(θ)의 관계를 보여줍니다.</title>
                    <line x1="10" y1="240" x2="390" y2="240" stroke="gray" strokeWidth="2" />
                    <g><rect x="300" y="40" width="60" height="200" fill="#CBD5E1" stroke="#475569" strokeWidth="1.5" /><rect x="310" y="55" width="15" height="20" fill="#F1F5F9" /><rect x="335" y="55" width="15" height="20" fill="#F1F5F9" /><rect x="310" y="85" width="15" height="20" fill="#F1F5F9" /><rect x="335" y="85" width="15" height="20" fill="#F1F5F9" /><rect x="310" y="115" width="15" height="20" fill="#F1F5F9" /><rect x="335" y="115" width="15" height="20" fill="#F1F5F9" /></g>
                    <g><circle cx="80" cy="190" r="10" fill="none" stroke="#475569" strokeWidth="1.5" /><line x1="80" y1="200" x2="80" y2="225" stroke="#475569" strokeWidth="1.5" /><line x1="80" y1="225" x2="70" y2="240" stroke="#475569" strokeWidth="1.5" /><line x1="80" y1="225" x2="90" y2="240" stroke="#475569" strokeWidth="1.5" /><line x1="80" y1="210" x2="70" y2="200" stroke="#475569" strokeWidth="1.5" /><line x1="80" y1="210" x2="90" y2="200" stroke="#475569" strokeWidth="1.5" /></g>
                    <line x1="80" y1="190" x2="300" y2="40" stroke="#0EA5E9" strokeWidth="1.5" strokeDasharray="4 2" />
                    <line x1="80" y1="190" x2="300" y2="190" stroke="#475569" strokeWidth="1" strokeDasharray="3 3" />
                    
                    <g id="diagram-angle" class="diagram-part default-angle-stroke default-fill"><path d="M 100 190 A 20 20 0 0 1 118.4 182.2" fill="none" stroke-width="1" /><text x="125" y="180" id="diagram-angle-text" fontSize="14">θ</text></g>
                    <g id="diagram-distance" class="diagram-part default-stroke default-fill"><line x1="80" y1="245" x2="300" y2="245" stroke-width="1" /><line x1="80" y1="240" x2="80" y2="250" stroke-width="1" /><line x1="300" y1="240" x2="300" y2="250" stroke-width="1" /><text x="190" y="260" id="diagram-distance-text" textAnchor="middle" fontSize="14">거리 (d)</text></g>
                    <g id="diagram-eyeHeight" class="diagram-part default-stroke default-fill"><line x1="70" y1="190" x2="70" y2="240" stroke-width="1" /><line x1="65" y1="190" x2="75" y2="190" stroke-width="1" /><line x1="65" y1="240" x2="75" y2="240" stroke-width="1" /><text x="45" y="215" id="diagram-eyeHeight-text" textAnchor="middle" fontSize="14">눈높이 (h₁)</text></g>
                    <g id="diagram-H" class="diagram-part default-stroke default-fill"><line x1="370" y1="40" x2="370" y2="240" stroke-width="1" /><line x1="365" y1="40" x2="375" y2="40" stroke-width="1" /><line x1="365" y1="240" x2="375" y2="240" stroke-width="1" /><text x="385" y="140" textAnchor="middle" fontSize="14">건물 높이 (H)</text></g>
                    <g id="diagram-h2" class="diagram-part default-stroke default-fill"><line x1="290" y1="40" x2="290" y2="190" strokeDasharray="2 2" stroke-width="1" /><text x="280" y="115" textAnchor="end" fontSize="14">h₂</text></g>
                    <g class="font-mono text-sm"><text x="10" y="20" fontSize="14" fontWeight="bold">H = h₁ + h₂</text><text x="10" y="40" fontSize="14" fontWeight="bold">h₂ = d × tan(θ)</text></g>
                </svg>
            </div>

            <div class="text-center mb-8">
                <button id="calculate-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-md hover:bg-blue-700 disabled:bg-slate-400 disabled:cursor-not-allowed transition-all duration-300 transform hover:scale-105">
                    높이 계산하기
                </button>
            </div>

            <div id="result-container" class="hidden bg-slate-50 border-t-4 border-blue-500 rounded-b-lg px-6 py-5 shadow-inner mt-6">
                <h2 class="text-2xl font-bold text-center mb-4 text-blue-800">📊 계산 과정</h2>
                <div class="space-y-3 text-lg font-mono text-slate-700">
                    <div id="step1" class="hidden px-4 py-3 bg-white rounded-md shadow-sm">
                        <p>H = h₁ + h₂</p>
                        <p class="text-sm text-slate-500">건물 높이 = 내 눈높이 + (내 눈높이부터 건물 꼭대기까지의 높이)</p>
                    </div>
                    <div id="step2" class="hidden px-4 py-3 bg-white rounded-md shadow-sm">
                        <p>h₂ = d × tan(θ)</p>
                        <p class="text-sm text-slate-500">h₂ = 거리 × tan(클리노미터 각도)</p>
                    </div>
                    <div id="step3" class="hidden px-4 py-3 bg-white rounded-md shadow-sm"></div>
                    <div id="step4" class="hidden px-4 py-3 bg-white rounded-md shadow-sm"></div>
                    <div id="step5" class="hidden !mt-6 text-center">
                        <p class="text-xl font-semibold text-slate-800 mb-2">최종 계산 높이:</p>
                        <p id="final-height" class="text-4xl font-bold text-blue-600 bg-blue-100 py-3 rounded-lg"></p>
                    </div>
                </div>
                <div id="result-buttons" class="hidden text-center mt-6 flex justify-center items-center gap-4">
                    <button id="reset-btn" class="bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-700 transition-colors duration-300">
                        다시하기
                    </button>
                    <a href="https://student.amplify.com/join/#/M8EG9X?lang=ko" target="_blank" rel="noopener noreferrer" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors duration-300">
                        Desmos 활동하기
                    </a>
                </div>
            </div>
        </div>
        <footer class="text-center mt-8 text-sm text-slate-500">
            <p>Trigonometry in Action | Educational Tool</p>
        </footer>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const distanceInput = document.getElementById('distance');
            const eyeHeightInput = document.getElementById('eyeHeight');
            const protractorAngleInput = document.getElementById('protractorAngle');
            const calculateBtn = document.getElementById('calculate-btn');
            const resetBtn = document.getElementById('reset-btn');

            const resultContainer = document.getElementById('result-container');
            const step1El = document.getElementById('step1');
            const step2El = document.getElementById('step2');
            const step3El = document.getElementById('step3');
            const step4El = document.getElementById('step4');
            const step5El = document.getElementById('step5');
            const finalHeightEl = document.getElementById('final-height');
            const resultButtons = document.getElementById('result-buttons');
            
            // Diagram Elements
            const diagramParts = {
                distance: document.getElementById('diagram-distance'),
                eyeHeight: document.getElementById('diagram-eyeHeight'),
                protractorAngle: document.getElementById('diagram-angle'),
                h2: document.getElementById('diagram-h2'),
                H: document.getElementById('diagram-H'),
            };
            const diagramTexts = {
                distance: document.getElementById('diagram-distance-text'),
                eyeHeight: document.getElementById('diagram-eyeHeight-text'),
                protractorAngle: document.getElementById('diagram-angle-text'),
            };

            let isCalculating = false;

            // --- Functions ---
            const updateButtonState = () => {
                const allFilled = distanceInput.value.trim() !== '' && eyeHeightInput.value.trim() !== '' && protractorAngleInput.value.trim() !== '';
                calculateBtn.disabled = !allFilled || isCalculating;
                calculateBtn.textContent = isCalculating ? '계산 중...' : '높이 계산하기';
            };

            const updateDiagramText = () => {
                const dist = distanceInput.value;
                const height = eyeHeightInput.value;
                const pAngle = parseFloat(protractorAngleInput.value);

                diagramTexts.distance.textContent = dist ? `거리 (d: ${dist}m)` : '거리 (d)';
                diagramTexts.eyeHeight.textContent = height ? `눈높이 (h₁: ${height}m)` : '눈높이 (h₁)';
                
                const clinometerAngle = !isNaN(pAngle) && pAngle > 0 && pAngle < 90 ? 90 - pAngle : null;
                diagramTexts.protractorAngle.textContent = clinometerAngle !== null ? `${clinometerAngle.toFixed(1)}°` : 'θ';
            };

            const highlightPart = (partName, forceRemove = false) => {
                 Object.values(diagramParts).forEach(el => {
                    el.classList.remove('highlight-blue', 'highlight-red');
                 });
                 if (forceRemove) return;

                 if (partName === 'distance_angle') {
                     diagramParts.distance.classList.add('highlight-blue');
                     diagramParts.protractorAngle.classList.add('highlight-red');
                 } else if (diagramParts[partName]) {
                     const isAngle = partName === 'protractorAngle';
                     diagramParts[partName].classList.add(isAngle ? 'highlight-red' : 'highlight-blue');
                 }
            };
            
            const handleCalculate = () => {
                const dist = parseFloat(distanceInput.value);
                const height = parseFloat(eyeHeightInput.value);
                const angle = parseFloat(protractorAngleInput.value);

                if (isNaN(dist) || isNaN(height) || isNaN(angle) || dist <= 0 || height <= 0 || angle <= 0 || angle >= 90) {
                    alert('유효한 값을 입력해주세요. (모든 값은 0보다 커야하며, 각도기로 잰 각도는 90보다 작아야 합니다)');
                    return;
                }

                isCalculating = true;
                updateButtonState();
                resultContainer.classList.remove('hidden');

                const clinometerAngle = 90 - angle;
                const angleInRadians = clinometerAngle * (Math.PI / 180);
                const calculatedH2 = dist * Math.tan(angleInRadians);
                const finalHeight = height + calculatedH2;

                // Animation sequence
                setTimeout(() => { step1El.classList.remove('hidden'); step1El.classList.add('animate-fade-in-up'); highlightPart('eyeHeight'); }, 500);
                setTimeout(() => { step2El.classList.remove('hidden'); step2El.classList.add('animate-fade-in-up'); highlightPart('distance_angle'); }, 2000);
                setTimeout(() => {
                    step3El.innerHTML = `<p>h₂ = ${dist}m × tan(${clinometerAngle.toFixed(1)}°)</p><p class="font-bold text-indigo-600">h₂ ≈ ${calculatedH2.toFixed(2)}m</p>`;
                    step3El.classList.remove('hidden');
                    step3El.classList.add('animate-fade-in-up');
                }, 3500);
                setTimeout(() => {
                    step4El.innerHTML = `<p>H = ${height}m + ${calculatedH2.toFixed(2)}m</p>`;
                    step4El.classList.remove('hidden');
                    step4El.classList.add('animate-fade-in-up');
                    highlightPart('h2');
                }, 5000);
                setTimeout(() => {
                    finalHeightEl.textContent = `${finalHeight.toFixed(2)} m`;
                    step5El.classList.remove('hidden');
                    step5El.classList.add('animate-fade-in-up');
                    resultButtons.classList.remove('hidden');
                    resultButtons.classList.add('animate-fade-in-up');
                    resultButtons.style.animationDelay = '0.5s';
                    highlightPart('H');
                }, 6500);
                setTimeout(() => { highlightPart(null, true); }, 8000);
            };

            const handleReset = () => {
                distanceInput.value = '';
                eyeHeightInput.value = '';
                protractorAngleInput.value = '';
                
                isCalculating = false;
                updateButtonState();
                updateDiagramText();
                
                resultContainer.classList.add('hidden');
                [step1El, step2El, step3El, step4El, step5El, resultButtons].forEach(el => el.classList.add('hidden'));
                
                highlightPart(null, true);
            };

            // Event Listeners
            const inputs = [distanceInput, eyeHeightInput, protractorAngleInput];
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    updateButtonState();
                    updateDiagramText();
                });
            });

            distanceInput.addEventListener('focus', () => highlightPart('distance'));
            eyeHeightInput.addEventListener('focus', () => highlightPart('eyeHeight'));
            protractorAngleInput.addEventListener('focus', () => highlightPart('protractorAngle'));

            distanceInput.addEventListener('blur', () => highlightPart(null, true));
            eyeHeightInput.addEventListener('blur', () => highlightPart(null, true));
            protractorAngleInput.addEventListener('blur', () => highlightPart(null, true));

            calculateBtn.addEventListener('click', handleCalculate);
            resetBtn.addEventListener('click', handleReset);
            
            // Initial State
            updateButtonState();
        });
    </script>
</body>
</html>